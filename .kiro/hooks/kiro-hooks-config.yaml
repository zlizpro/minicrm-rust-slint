# Kiro Agent Hooks é…ç½®æ–‡ä»¶
# åŸºäº code-generation-guidelines.md æŒ‡å¯¼æ–¹é’ˆ

hooks:
  - name: "ä»£ç è´¨é‡æ£€æŸ¥"
    id: "code-quality-on-save"
    description: "æ–‡ä»¶ä¿å­˜æ—¶è‡ªåŠ¨è¿›è¡Œä»£ç æ ¼å¼åŒ–å’Œè´¨é‡æ£€æŸ¥"
    trigger: "file_save"
    patterns: ["**/*.rs", "**/*.swift", "**/*.py", "**/*.ts", "**/*.js"]
    enabled: true
    script: |
      #!/bin/bash
      echo "ğŸ” æ­£åœ¨è¿›è¡Œä»£ç è´¨é‡æ£€æŸ¥..."
      
      # æ£€æŸ¥æ–‡ä»¶å¤§å°
      if [ -f "$KIRO_FILE_PATH" ]; then
        lines=$(wc -l < "$KIRO_FILE_PATH")
        if [ $lines -gt 500 ]; then
          echo "âš ï¸ è­¦å‘Š: æ–‡ä»¶è¶…è¿‡500è¡Œ ($lines è¡Œ)ï¼Œå»ºè®®æ‹†åˆ†"
        fi
      fi
      
      # æ ¹æ®é¡¹ç›®ç±»å‹æ‰§è¡Œæ£€æŸ¥
      if [ -f "Cargo.toml" ]; then
        echo "ğŸ¦€ Rusté¡¹ç›®æ£€æŸ¥..."
        cargo fmt --check || cargo fmt
        cargo clippy --quiet
      elif [ -f "Package.swift" ]; then
        echo "ğŸ Swifté¡¹ç›®æ£€æŸ¥..."
        swift-format format --in-place "$KIRO_FILE_PATH" 2>/dev/null || true
      elif [ -f "requirements.txt" ] || [ -f "pyproject.toml" ]; then
        echo "ğŸ Pythoné¡¹ç›®æ£€æŸ¥..."
        black --check "$KIRO_FILE_PATH" || black "$KIRO_FILE_PATH"
      elif [ -f "package.json" ]; then
        echo "ğŸ“¦ Node.jsé¡¹ç›®æ£€æŸ¥..."
        prettier --check "$KIRO_FILE_PATH" || prettier --write "$KIRO_FILE_PATH"
      fi
      
      echo "âœ… ä»£ç è´¨é‡æ£€æŸ¥å®Œæˆ"

  - name: "æµ‹è¯•è¦†ç›–ç‡ç›‘æ§"
    id: "test-coverage-monitor"
    description: "ä»£ç å˜æ›´åè‡ªåŠ¨è¿è¡Œç›¸å…³æµ‹è¯•"
    trigger: "file_change"
    patterns: ["**/*.rs", "**/*.swift", "**/*.py", "**/*.ts"]
    exclude_patterns: ["**/tests/**", "**/*_test.*", "**/*.test.*"]
    enabled: true
    script: |
      #!/bin/bash
      echo "ğŸ“Š å¼€å§‹æµ‹è¯•è¦†ç›–ç‡æ£€æŸ¥..."
      
      if [ -f "Cargo.toml" ]; then
        echo "ğŸ¦€ è¿è¡ŒRustæµ‹è¯•..."
        cargo test --quiet
      elif [ -f "Package.swift" ]; then
        echo "ğŸ è¿è¡ŒSwiftæµ‹è¯•..."
        swift test
      elif [ -f "requirements.txt" ]; then
        echo "ğŸ è¿è¡ŒPythonæµ‹è¯•..."
        python -m pytest --quiet
      elif [ -f "package.json" ]; then
        echo "ğŸ“¦ è¿è¡ŒNode.jsæµ‹è¯•..."
        npm test
      fi
      
      echo "âœ… æµ‹è¯•å®Œæˆ"

  - name: "æäº¤å‰è´¨é‡é—¨ç¦"
    id: "pre-commit-quality-gate"
    description: "Gitæäº¤å‰è¿›è¡Œå®Œæ•´çš„ä»£ç è´¨é‡æ£€æŸ¥"
    trigger: "git_pre_commit"
    enabled: true
    script: |
      #!/bin/bash
      echo "ğŸ” å¼€å§‹æäº¤å‰è´¨é‡æ£€æŸ¥..."
      
      # ä»£ç æ ¼å¼æ£€æŸ¥
      if [ -f "Cargo.toml" ]; then
        echo "ğŸ¦€ Rusté¡¹ç›®å®Œæ•´æ£€æŸ¥..."
        cargo fmt --check || { echo "âŒ ä»£ç æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·è¿è¡Œ cargo fmt"; exit 1; }
        cargo clippy --all-targets -- -D warnings || { echo "âŒ Clippyæ£€æŸ¥å¤±è´¥"; exit 1; }
        cargo test || { echo "âŒ æµ‹è¯•å¤±è´¥"; exit 1; }
      elif [ -f "Package.swift" ]; then
        echo "ğŸ Swifté¡¹ç›®å®Œæ•´æ£€æŸ¥..."
        swift test || { echo "âŒ æµ‹è¯•å¤±è´¥"; exit 1; }
      elif [ -f "requirements.txt" ]; then
        echo "ğŸ Pythoné¡¹ç›®å®Œæ•´æ£€æŸ¥..."
        black --check . || { echo "âŒ ä»£ç æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·è¿è¡Œ black ."; exit 1; }
        python -m pytest || { echo "âŒ æµ‹è¯•å¤±è´¥"; exit 1; }
      fi
      
      echo "âœ… æ‰€æœ‰è´¨é‡æ£€æŸ¥é€šè¿‡ï¼Œå¯ä»¥æäº¤"

  - name: "ä¾èµ–å®‰å…¨æ£€æŸ¥"
    id: "dependency-security-check"
    description: "æ£€æŸ¥ä¾èµ–å®‰å…¨æ¼æ´å’Œæ›´æ–°"
    trigger: "manual"
    enabled: false
    script: |
      #!/bin/bash
      echo "ğŸ”’ å¼€å§‹ä¾èµ–å®‰å…¨æ£€æŸ¥..."
      
      if [ -f "Cargo.toml" ]; then
        echo "ğŸ¦€ æ£€æŸ¥Rustä¾èµ–..."
        cargo audit 2>/dev/null || echo "âš ï¸ è¯·å®‰è£… cargo-audit: cargo install cargo-audit"
      elif [ -f "requirements.txt" ]; then
        echo "ğŸ æ£€æŸ¥Pythonä¾èµ–..."
        pip list --outdated
        safety check 2>/dev/null || echo "âš ï¸ è¯·å®‰è£… safety: pip install safety"
      elif [ -f "package.json" ]; then
        echo "ğŸ“¦ æ£€æŸ¥Node.jsä¾èµ–..."
        npm audit
      fi
      
      echo "âœ… ä¾èµ–æ£€æŸ¥å®Œæˆ"

  - name: "æ€§èƒ½ç›‘æ§"
    id: "performance-monitor"
    description: "ç›‘æ§æ„å»ºæ€§èƒ½å’Œä»£ç å¤æ‚åº¦"
    trigger: "manual"
    enabled: false
    script: |
      #!/bin/bash
      echo "âš¡ å¼€å§‹æ€§èƒ½ç›‘æ§..."
      
      if [ -f "Cargo.toml" ]; then
        echo "ğŸ¦€ Rustæ€§èƒ½åˆ†æ..."
        cargo build --release --timings
        echo "ğŸ“Š æ„å»ºæ—¶é—´æŠ¥å‘Šç”Ÿæˆåœ¨ target/cargo-timings/"
      elif [ -f "Package.swift" ]; then
        echo "ğŸ Swiftæ€§èƒ½åˆ†æ..."
        time swift build -c release
      fi
      
      echo "âœ… æ€§èƒ½ç›‘æ§å®Œæˆ"